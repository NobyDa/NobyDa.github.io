<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>适用于Surge &amp; QuantumultX的一次性密码生成脚本 (TOTP) - NobyDa&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="NobyDa&#039;s Blog"><meta name="msapplication-TileImage" content="img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="NobyDa&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="TOTP全称为 “基于时间的一次性密码”，又称两步验证、双因素认证； 本文将简单介绍如何在Surge或QuantumultX等原生JavaScript环境里实现获取TOTP 6位数一次性密码。"><meta property="og:type" content="blog"><meta property="og:title" content="适用于Surge &amp; QuantumultX的一次性密码生成脚本 (TOTP)"><meta property="og:url" content="https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/"><meta property="og:site_name" content="NobyDa&#039;s Blog"><meta property="og:description" content="TOTP全称为 “基于时间的一次性密码”，又称两步验证、双因素认证； 本文将简单介绍如何在Surge或QuantumultX等原生JavaScript环境里实现获取TOTP 6位数一次性密码。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://nobyda.github.io/gallery/Javascript-TOTP-algorithm.jpg"><meta property="article:published_time" content="2021-07-29T08:30:00.000Z"><meta property="article:modified_time" content="2021-07-29T08:41:18.782Z"><meta property="article:author" content="NobyDa"><meta property="article:tag" content="Surge"><meta property="article:tag" content="QuantumultX"><meta property="article:tag" content="JavaScript"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/Javascript-TOTP-algorithm.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/"},"headline":"NobyDa","image":["https://nobyda.github.io/gallery/Javascript-TOTP-algorithm.jpg"],"datePublished":"2021-07-29T08:30:00.000Z","dateModified":"2021-07-29T08:41:18.782Z","author":{"@type":"Person","name":"NobyDa"},"publisher":{"@type":"Organization","name":"NobyDa's Blog","logo":{"@type":"ImageObject","url":"https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/img/logo.svg"}},"description":"TOTP全称为 “基于时间的一次性密码”，又称两步验证、双因素认证； 本文将简单介绍如何在Surge或QuantumultX等原生JavaScript环境里实现获取TOTP 6位数一次性密码。"}</script><link rel="canonical" href="https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="NobyDa&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-9-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/Javascript-TOTP-algorithm.jpg" alt="适用于Surge &amp; QuantumultX的一次性密码生成脚本 (TOTP)"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-07-29T08:30:00.000Z" title="2021/7/29 16:30:00">2021-07-29</time>发表</span><span class="level-item"><time dateTime="2021-07-29T08:41:18.782Z" title="2021/7/29 16:41:18">2021-07-29</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91/">脚本开发</a></span><span class="level-item">11 分钟读完 (大约1592个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> 次浏览</span></div></div><h1 class="title is-3 is-size-4-mobile">适用于Surge &amp; QuantumultX的一次性密码生成脚本 (TOTP)</h1><div class="content"><p>TOTP全称为 “基于时间的一次性密码”，又称两步验证、双因素认证；</p>
<p>本文将简单介绍如何在Surge或QuantumultX等原生JavaScript环境里实现获取TOTP 6位数一次性密码。</p>
<span id="more"></span>

<p>一次性密码也称为动态口令，通常用在web应用或者其他登录系统中，是增强静态密码的一种非常方便的技术手段。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>TOTP的基本认证原理简单概括：</p>
<p>客户端/服务端使用密码技术生成密钥后双方共享该密钥，之后需要验证时使用同一个密钥对当前时间进行密码算法计算，再比较计算值是否一致进行认证；</p>
<p>计算后生成的动态口令通常30秒失效，口令长度通常为6位数字；认证时的唯一要求是客户端和服务端能够十分精确的保持正确的时钟，客户端和服务端计算的动态口令才能一致。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>因为上一篇文章所演示的 “巴哈姆特签到脚本” 中，部分用户反映如果账号设置两步验证后脚本将无法登录；</p>
<p>所以抽时间适配了一个支持在任何Javascript环境中都可用的TOTP算法函数。</p>
<p>该函数已开源，项目地址：<a target="_blank" rel="noopener" href="https://github.com/NobyDa/Script/tree/master/Time-based-One-Time-Password">Time-based-One-Time-Password</a></p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight javascript"><figcaption><span>TOTP.min.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-string">&#x27;YOURCLIENTTOKEN&#x27;</span>; <span class="hljs-comment">//TOTP密钥</span><br><span class="hljs-keyword">const</span> totp = TOTP(key); <span class="hljs-comment">//返回六位数一次性口令。</span><br><br><span class="hljs-built_in">console</span>.log(totp); <span class="hljs-comment">//打印日志</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TOTP</span>(<span class="hljs-params">token</span>)</span>&#123;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">t</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=<span class="hljs-number">0</span>,c=[],b=<span class="hljs-number">0</span>,f,k,l,h,m,w,n,y,p=!<span class="hljs-number">1</span>,q=[],t=[],v,u=!<span class="hljs-number">1</span>;d=d||&#123;&#125;;f=d.encoding||<span class="hljs-string">&quot;UTF8&quot;</span>;v=d.numRounds||<span class="hljs-number">1</span>;l=z(a,f);<span class="hljs-keyword">if</span>(v!==<span class="hljs-built_in">parseInt</span>(v,<span class="hljs-number">10</span>)||<span class="hljs-number">1</span>&gt;v)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;numRounds must a integer &gt;= 1&quot;</span>);<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;SHA-1&quot;</span>===e)m=<span class="hljs-number">512</span>,w=A,n=H,h=<span class="hljs-number">160</span>,y=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> a.slice()&#125;;<span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Chosen SHA variant is not supported&quot;</span>);k=x(e);<span class="hljs-built_in">this</span>.setHMACKey=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,c</span>)</span>&#123;<span class="hljs-keyword">var</span> d;<span class="hljs-keyword">if</span>(!<span class="hljs-number">0</span>===p)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;HMAC key already set&quot;</span>);<span class="hljs-keyword">if</span>(!<span class="hljs-number">0</span>===u)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Cannot set HMAC key after calling update&quot;</span>);f=(c||&#123;&#125;).encoding||<span class="hljs-string">&quot;UTF8&quot;</span>;b=z(b,f)(a);a=b.binLen;b=b.value;d=m&gt;&gt;&gt;<span class="hljs-number">3</span>;c=d/<span class="hljs-number">4</span>-<span class="hljs-number">1</span>;<span class="hljs-keyword">if</span>(d&lt;a/<span class="hljs-number">8</span>)&#123;<span class="hljs-keyword">for</span>(b=n(b,a,<span class="hljs-number">0</span>,x(e),h);b.length&lt;=c;)b.push(<span class="hljs-number">0</span>);b[c]&amp;=<span class="hljs-number">4294967040</span>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(d&gt;a/<span class="hljs-number">8</span>)&#123;<span class="hljs-keyword">for</span>(;b.length&lt;=c;)b.push(<span class="hljs-number">0</span>);b[c]&amp;=<span class="hljs-number">4294967040</span>&#125;<span class="hljs-keyword">for</span>(a=<span class="hljs-number">0</span>;a&lt;=c;a+=<span class="hljs-number">1</span>)q[a]=b[a]^<span class="hljs-number">909522486</span>,t[a]=b[a]^<span class="hljs-number">1549556828</span>;k=w(q,k);g=m;p=!<span class="hljs-number">0</span>&#125;;<span class="hljs-built_in">this</span>.update=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">var</span> d,e,f,h=<span class="hljs-number">0</span>,n=m&gt;&gt;&gt;<span class="hljs-number">5</span>;d=l(a,c,b);a=d.binLen;e=d.value;d=a&gt;&gt;&gt;<span class="hljs-number">5</span>;<span class="hljs-keyword">for</span>(f=<span class="hljs-number">0</span>;f&lt;d;f+=n)h+m&lt;=a&amp;&amp;(k=w(e.slice(f,f+n),k),h+=m);g+=h;c=e.slice(h&gt;&gt;&gt;<span class="hljs-number">5</span>);b=a%m;u=!<span class="hljs-number">0</span>&#125;;<span class="hljs-built_in">this</span>.getHash=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> f,l,m,r;<span class="hljs-keyword">if</span>(!<span class="hljs-number">0</span>===p)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Cannot call getHash after setting HMAC key&quot;</span>);m=B(d);<span class="hljs-keyword">switch</span>(a)&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;HEX&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> C(a,h,m)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;B64&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> D(a,h,m)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;BYTES&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> E(a,h)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;ARRAYBUFFER&quot;</span>:<span class="hljs-keyword">try</span>&#123;l=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">0</span>)&#125;<span class="hljs-keyword">catch</span>(I)&#123;<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;ARRAYBUFFER not supported by this environment&quot;</span>);&#125;f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> F(a,h)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;format must be HEX, B64, BYTES, or ARRAYBUFFER&quot;</span>);&#125;r=n(c.slice(),b,g,y(k),h);<span class="hljs-keyword">for</span>(l=<span class="hljs-number">1</span>;l&lt;v;l+=<span class="hljs-number">1</span>)r=n(r,h,<span class="hljs-number">0</span>,x(e),h);<span class="hljs-keyword">return</span> f(r)&#125;;<span class="hljs-built_in">this</span>.getHMAC=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> f,l,q,r;<span class="hljs-keyword">if</span>(!<span class="hljs-number">1</span>===p)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Cannot call getHMAC without first setting HMAC key&quot;</span>);q=B(d);<span class="hljs-keyword">switch</span>(a)&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;HEX&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> C(a,h,q)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;B64&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> D(a,h,q)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;BYTES&quot;</span>:f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> E(a,h)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;ARRAYBUFFER&quot;</span>:<span class="hljs-keyword">try</span>&#123;f=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">0</span>)&#125;<span class="hljs-keyword">catch</span>(I)&#123;<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;ARRAYBUFFER not supported by this environment&quot;</span>);&#125;f=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<span class="hljs-keyword">return</span> F(a,h)&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER&quot;</span>);&#125;l=n(c.slice(),b,g,y(k),h);r=w(t,x(e));r=n(l,h,m,r,h);<span class="hljs-keyword">return</span> f(r)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">J</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=e.length,c,b,f,k,l;a=a||[<span class="hljs-number">0</span>];d=d||<span class="hljs-number">0</span>;l=d&gt;&gt;&gt;<span class="hljs-number">3</span>;<span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>!==g%<span class="hljs-number">2</span>)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;String of HEX type must be in byte increments&quot;</span>);<span class="hljs-keyword">for</span>(c=<span class="hljs-number">0</span>;c&lt;g;c+=<span class="hljs-number">2</span>)&#123;b=<span class="hljs-built_in">parseInt</span>(e.substr(c,<span class="hljs-number">2</span>),<span class="hljs-number">16</span>);<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(b))<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;String of HEX type contains invalid characters&quot;</span>);k=(c&gt;&gt;&gt;<span class="hljs-number">1</span>)+l;<span class="hljs-keyword">for</span>(f=k&gt;&gt;&gt;<span class="hljs-number">2</span>;a.length&lt;=f;)a.push(<span class="hljs-number">0</span>);a[f]|=b&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-k%<span class="hljs-number">4</span>)&#125;<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">value</span>:a,<span class="hljs-attr">binLen</span>:<span class="hljs-number">4</span>*g+d&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">K</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=[],c,b,f,k,g=a||[<span class="hljs-number">0</span>];d=d||<span class="hljs-number">0</span>;b=d&gt;&gt;&gt;<span class="hljs-number">3</span>;<span class="hljs-keyword">for</span>(c=<span class="hljs-number">0</span>;c&lt;e.length;c+=<span class="hljs-number">1</span>)a=e.charCodeAt(c),k=c+b,f=k&gt;&gt;&gt;<span class="hljs-number">2</span>,g.length&lt;=f&amp;&amp;g.push(<span class="hljs-number">0</span>),g[f]|=a&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-k%<span class="hljs-number">4</span>);<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">value</span>:g,<span class="hljs-attr">binLen</span>:<span class="hljs-number">8</span>*e.length+d&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">L</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=[],c=<span class="hljs-number">0</span>,b,f,k,l,h,m,g=a||[<span class="hljs-number">0</span>];d=d||<span class="hljs-number">0</span>;a=d&gt;&gt;&gt;<span class="hljs-number">3</span>;<span class="hljs-keyword">if</span>(-<span class="hljs-number">1</span>===e.search(<span class="hljs-regexp">/^[a-zA-Z0-9=+\/]+$/</span>))<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Invalid character in base-64 string&quot;</span>);f=e.indexOf(<span class="hljs-string">&quot;=&quot;</span>);e=e.replace(<span class="hljs-regexp">/\=/g</span>,<span class="hljs-string">&quot;&quot;</span>);<span class="hljs-keyword">if</span>(-<span class="hljs-number">1</span>!==f&amp;&amp;f&lt;e.length)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Invalid &#x27;=&#x27; found in base-64 string&quot;</span>);<span class="hljs-keyword">for</span>(f=<span class="hljs-number">0</span>;f&lt;e.length;f+=<span class="hljs-number">4</span>)&#123;h=e.substr(f,<span class="hljs-number">4</span>);<span class="hljs-keyword">for</span>(k=l=<span class="hljs-number">0</span>;k&lt;h.length;k+=<span class="hljs-number">1</span>)b=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>.indexOf(h[k]),l|=b&lt;&lt;<span class="hljs-number">18</span>-<span class="hljs-number">6</span>*k;<span class="hljs-keyword">for</span>(k=<span class="hljs-number">0</span>;k&lt;h.length-<span class="hljs-number">1</span>;k+=<span class="hljs-number">1</span>)&#123;m=c+a;<span class="hljs-keyword">for</span>(b=m&gt;&gt;&gt;<span class="hljs-number">2</span>;g.length&lt;=b;)g.push(<span class="hljs-number">0</span>);g[b]|=(l&gt;&gt;&gt;<span class="hljs-number">16</span>-<span class="hljs-number">8</span>*k&amp;<span class="hljs-number">255</span>)&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-m%<span class="hljs-number">4</span>);c+=<span class="hljs-number">1</span>&#125;&#125;<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">value</span>:g,<span class="hljs-attr">binLen</span>:<span class="hljs-number">8</span>*c+d&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">M</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=[],c,b,f,g=a||[<span class="hljs-number">0</span>];d=d||<span class="hljs-number">0</span>;c=d&gt;&gt;&gt;<span class="hljs-number">3</span>;<span class="hljs-keyword">for</span>(a=<span class="hljs-number">0</span>;a&lt;e.byteLength;a+=<span class="hljs-number">1</span>)f=a+c,b=f&gt;&gt;&gt;<span class="hljs-number">2</span>,g.length&lt;=b&amp;&amp;g.push(<span class="hljs-number">0</span>),g[b]|=e[a]&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-f%<span class="hljs-number">4</span>);<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">value</span>:g,<span class="hljs-attr">binLen</span>:<span class="hljs-number">8</span>*e.byteLength+d&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">C</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=<span class="hljs-string">&quot;&quot;</span>;a/=<span class="hljs-number">8</span>;<span class="hljs-keyword">var</span> c,b;<span class="hljs-keyword">for</span>(c=<span class="hljs-number">0</span>;c&lt;a;c+=<span class="hljs-number">1</span>)b=e[c&gt;&gt;&gt;<span class="hljs-number">2</span>]&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-c%<span class="hljs-number">4</span>),g+=<span class="hljs-string">&quot;0123456789abcdef&quot;</span>.charAt(b&gt;&gt;&gt;<span class="hljs-number">4</span>&amp;<span class="hljs-number">15</span>)+<span class="hljs-string">&quot;0123456789abcdef&quot;</span>.charAt(b&amp;<span class="hljs-number">15</span>);<span class="hljs-keyword">return</span> d.outputUpper?g.toUpperCase():g&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">D</span>(<span class="hljs-params">e,a,d</span>)</span>&#123;<span class="hljs-keyword">var</span> g=<span class="hljs-string">&quot;&quot;</span>,c=a/<span class="hljs-number">8</span>,b,f,k;<span class="hljs-keyword">for</span>(b=<span class="hljs-number">0</span>;b&lt;c;b+=<span class="hljs-number">3</span>)<span class="hljs-keyword">for</span>(f=b+<span class="hljs-number">1</span>&lt;c?e[b+<span class="hljs-number">1</span>&gt;&gt;&gt;<span class="hljs-number">2</span>]:<span class="hljs-number">0</span>,k=b+<span class="hljs-number">2</span>&lt;c?e[b+<span class="hljs-number">2</span>&gt;&gt;&gt;<span class="hljs-number">2</span>]:<span class="hljs-number">0</span>,k=(e[b&gt;&gt;&gt;<span class="hljs-number">2</span>]&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-b%<span class="hljs-number">4</span>)&amp;<span class="hljs-number">255</span>)&lt;&lt;<span class="hljs-number">16</span>|(f&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-(b+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>)&amp;<span class="hljs-number">255</span>)&lt;&lt;<span class="hljs-number">8</span>|k&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-(b+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>)&amp;<span class="hljs-number">255</span>,f=<span class="hljs-number">0</span>;<span class="hljs-number">4</span>&gt;f;f+=<span class="hljs-number">1</span>)<span class="hljs-number">8</span>*b+<span class="hljs-number">6</span>*f&lt;=a?g+=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>.charAt(k&gt;&gt;&gt;<span class="hljs-number">6</span>*(<span class="hljs-number">3</span>-f)&amp;<span class="hljs-number">63</span>):g+=d.b64Pad;<span class="hljs-keyword">return</span> g&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">E</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">var</span> d=<span class="hljs-string">&quot;&quot;</span>,g=a/<span class="hljs-number">8</span>,c,b;<span class="hljs-keyword">for</span>(c=<span class="hljs-number">0</span>;c&lt;g;c+=<span class="hljs-number">1</span>)b=e[c&gt;&gt;&gt;<span class="hljs-number">2</span>]&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-c%<span class="hljs-number">4</span>)&amp;<span class="hljs-number">255</span>,d+=<span class="hljs-built_in">String</span>.fromCharCode(b);<span class="hljs-keyword">return</span> d&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">F</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">var</span> d=a/<span class="hljs-number">8</span>,g,c=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(d);<span class="hljs-keyword">for</span>(g=<span class="hljs-number">0</span>;g&lt;d;g+=<span class="hljs-number">1</span>)c[g]=e[g&gt;&gt;&gt;<span class="hljs-number">2</span>]&gt;&gt;&gt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-g%<span class="hljs-number">4</span>)&amp;<span class="hljs-number">255</span>;<span class="hljs-keyword">return</span> c&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">B</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">var</span> a=&#123;<span class="hljs-attr">outputUpper</span>:!<span class="hljs-number">1</span>,<span class="hljs-attr">b64Pad</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-attr">shakeLen</span>:-<span class="hljs-number">1</span>&#125;;e=e||&#123;&#125;;a.outputUpper=e.outputUpper||!<span class="hljs-number">1</span>;!<span class="hljs-number">0</span>===e.hasOwnProperty(<span class="hljs-string">&quot;b64Pad&quot;</span>)&amp;&amp;(a.b64Pad=e.b64Pad);<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;boolean&quot;</span>!==<span class="hljs-keyword">typeof</span> a.outputUpper)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Invalid outputUpper formatting option&quot;</span>);<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;string&quot;</span>!==<span class="hljs-keyword">typeof</span> a.b64Pad)<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Invalid b64Pad formatting option&quot;</span>);<span class="hljs-keyword">return</span> a&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">z</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">var</span> d;<span class="hljs-keyword">switch</span>(a)&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;UTF8&quot;</span>:<span class="hljs-keyword">case</span><span class="hljs-string">&quot;UTF16BE&quot;</span>:<span class="hljs-keyword">case</span><span class="hljs-string">&quot;UTF16LE&quot;</span>:<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;encoding must be UTF8, UTF16BE, or UTF16LE&quot;</span>);&#125;<span class="hljs-keyword">switch</span>(e)&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;HEX&quot;</span>:d=J;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;TEXT&quot;</span>:d=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d,c,b</span>)</span>&#123;<span class="hljs-keyword">var</span> f=[],e=[],l=<span class="hljs-number">0</span>,h,m,q,n,p,f=c||[<span class="hljs-number">0</span>];c=b||<span class="hljs-number">0</span>;q=c&gt;&gt;&gt;<span class="hljs-number">3</span>;<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;UTF8&quot;</span>===a)<span class="hljs-keyword">for</span>(h=<span class="hljs-number">0</span>;h&lt;d.length;h+=<span class="hljs-number">1</span>)<span class="hljs-keyword">for</span>(b=d.charCodeAt(h),e=[],<span class="hljs-number">128</span>&gt;b?e.push(b):<span class="hljs-number">2048</span>&gt;b?(e.push(<span class="hljs-number">192</span>|b&gt;&gt;&gt;<span class="hljs-number">6</span>),e.push(<span class="hljs-number">128</span>|b&amp;<span class="hljs-number">63</span>)):<span class="hljs-number">55296</span>&gt;b||<span class="hljs-number">57344</span>&lt;=b?e.push(<span class="hljs-number">224</span>|b&gt;&gt;&gt;<span class="hljs-number">12</span>,<span class="hljs-number">128</span>|b&gt;&gt;&gt;<span class="hljs-number">6</span>&amp;<span class="hljs-number">63</span>,<span class="hljs-number">128</span>|b&amp;<span class="hljs-number">63</span>):(h+=<span class="hljs-number">1</span>,b=<span class="hljs-number">65536</span>+((b&amp;<span class="hljs-number">1023</span>)&lt;&lt;<span class="hljs-number">10</span>|d.charCodeAt(h)&amp;<span class="hljs-number">1023</span>),e.push(<span class="hljs-number">240</span>|b&gt;&gt;&gt;<span class="hljs-number">18</span>,<span class="hljs-number">128</span>|b&gt;&gt;&gt;<span class="hljs-number">12</span>&amp;<span class="hljs-number">63</span>,<span class="hljs-number">128</span>|b&gt;&gt;&gt;<span class="hljs-number">6</span>&amp;<span class="hljs-number">63</span>,<span class="hljs-number">128</span>|b&amp;<span class="hljs-number">63</span>)),m=<span class="hljs-number">0</span>;m&lt;e.length;m+=<span class="hljs-number">1</span>)&#123;p=l+q;<span class="hljs-keyword">for</span>(n=p&gt;&gt;&gt;<span class="hljs-number">2</span>;f.length&lt;=n;)f.push(<span class="hljs-number">0</span>);f[n]|=e[m]&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">3</span>-p%<span class="hljs-number">4</span>);l+=<span class="hljs-number">1</span>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;UTF16BE&quot;</span>===a||<span class="hljs-string">&quot;UTF16LE&quot;</span>===a)<span class="hljs-keyword">for</span>(h=<span class="hljs-number">0</span>;h&lt;d.length;h+=<span class="hljs-number">1</span>)&#123;b=d.charCodeAt(h);<span class="hljs-string">&quot;UTF16LE&quot;</span>===a&amp;&amp;(m=b&amp;<span class="hljs-number">255</span>,b=m&lt;&lt;<span class="hljs-number">8</span>|b&gt;&gt;&gt;<span class="hljs-number">8</span>);p=l+q;<span class="hljs-keyword">for</span>(n=p&gt;&gt;&gt;<span class="hljs-number">2</span>;f.length&lt;=n;)f.push(<span class="hljs-number">0</span>);f[n]|=b&lt;&lt;<span class="hljs-number">8</span>*(<span class="hljs-number">2</span>-p%<span class="hljs-number">4</span>);l+=<span class="hljs-number">2</span>&#125;<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">value</span>:f,<span class="hljs-attr">binLen</span>:<span class="hljs-number">8</span>*l+c&#125;&#125;;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;B64&quot;</span>:d=L;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;BYTES&quot;</span>:d=K;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;ARRAYBUFFER&quot;</span>:<span class="hljs-keyword">try</span>&#123;d=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">0</span>)&#125;<span class="hljs-keyword">catch</span>(g)&#123;<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;ARRAYBUFFER not supported by this environment&quot;</span>);&#125;d=M;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER&quot;</span>);&#125;<span class="hljs-keyword">return</span> d&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">return</span> e&lt;&lt;a|e&gt;&gt;&gt;<span class="hljs-number">32</span>-a&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">q</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">var</span> d=(e&amp;<span class="hljs-number">65535</span>)+(a&amp;<span class="hljs-number">65535</span>);<span class="hljs-keyword">return</span>((e&gt;&gt;&gt;<span class="hljs-number">16</span>)+(a&gt;&gt;&gt;<span class="hljs-number">16</span>)+(d&gt;&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">65535</span>)&lt;&lt;<span class="hljs-number">16</span>|d&amp;<span class="hljs-number">65535</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">u</span>(<span class="hljs-params">e,a,d,g,c</span>)</span>&#123;<span class="hljs-keyword">var</span> b=(e&amp;<span class="hljs-number">65535</span>)+(a&amp;<span class="hljs-number">65535</span>)+(d&amp;<span class="hljs-number">65535</span>)+(g&amp;<span class="hljs-number">65535</span>)+(c&amp;<span class="hljs-number">65535</span>);<span class="hljs-keyword">return</span>((e&gt;&gt;&gt;<span class="hljs-number">16</span>)+(a&gt;&gt;&gt;<span class="hljs-number">16</span>)+(d&gt;&gt;&gt;<span class="hljs-number">16</span>)+(g&gt;&gt;&gt;<span class="hljs-number">16</span>)+(c&gt;&gt;&gt;<span class="hljs-number">16</span>)+(b&gt;&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">65535</span>)&lt;&lt;<span class="hljs-number">16</span>|b&amp;<span class="hljs-number">65535</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">x</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">var</span> a=[];<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;SHA-1&quot;</span>===e)a=[<span class="hljs-number">1732584193</span>,<span class="hljs-number">4023233417</span>,<span class="hljs-number">2562383102</span>,<span class="hljs-number">271733878</span>,<span class="hljs-number">3285377520</span>];<span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;No SHA variants supported&quot;</span>);<span class="hljs-keyword">return</span> a&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params">e,a</span>)</span>&#123;<span class="hljs-keyword">var</span> d=[],g,c,b,f,k,l,h;g=a[<span class="hljs-number">0</span>];c=a[<span class="hljs-number">1</span>];b=a[<span class="hljs-number">2</span>];f=a[<span class="hljs-number">3</span>];k=a[<span class="hljs-number">4</span>];<span class="hljs-keyword">for</span>(h=<span class="hljs-number">0</span>;<span class="hljs-number">80</span>&gt;h;h+=<span class="hljs-number">1</span>)d[h]=<span class="hljs-number">16</span>&gt;h?e[h]:p(d[h-<span class="hljs-number">3</span>]^d[h-<span class="hljs-number">8</span>]^d[h-<span class="hljs-number">14</span>]^d[h-<span class="hljs-number">16</span>],<span class="hljs-number">1</span>),l=<span class="hljs-number">20</span>&gt;h?u(p(g,<span class="hljs-number">5</span>),c&amp;b^~c&amp;f,k,<span class="hljs-number">1518500249</span>,d[h]):<span class="hljs-number">40</span>&gt;h?u(p(g,<span class="hljs-number">5</span>),c^b^f,k,<span class="hljs-number">1859775393</span>,d[h]):<span class="hljs-number">60</span>&gt;h?u(p(g,<span class="hljs-number">5</span>),c&amp;b^c&amp;f^b&amp;f,k,<span class="hljs-number">2400959708</span>,d[h]):u(p(g,<span class="hljs-number">5</span>),c^b^f,k,<span class="hljs-number">3395469782</span>,d[h]),k=f,f=b,b=p(c,<span class="hljs-number">30</span>),c=g,g=l;a[<span class="hljs-number">0</span>]=q(g,a[<span class="hljs-number">0</span>]);a[<span class="hljs-number">1</span>]=q(c,a[<span class="hljs-number">1</span>]);a[<span class="hljs-number">2</span>]=q(b,a[<span class="hljs-number">2</span>]);a[<span class="hljs-number">3</span>]=q(f,a[<span class="hljs-number">3</span>]);a[<span class="hljs-number">4</span>]=q(k,a[<span class="hljs-number">4</span>]);<span class="hljs-keyword">return</span> a&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">H</span>(<span class="hljs-params">e,a,d,g</span>)</span>&#123;<span class="hljs-keyword">var</span> c;<span class="hljs-keyword">for</span>(c=(a+<span class="hljs-number">65</span>&gt;&gt;&gt;<span class="hljs-number">9</span>&lt;&lt;<span class="hljs-number">4</span>)+<span class="hljs-number">15</span>;e.length&lt;=c;)e.push(<span class="hljs-number">0</span>);e[a&gt;&gt;&gt;<span class="hljs-number">5</span>]|=<span class="hljs-number">128</span>&lt;&lt;<span class="hljs-number">24</span>-a%<span class="hljs-number">32</span>;a+=d;e[c]=a&amp;<span class="hljs-number">4294967295</span>;e[c-<span class="hljs-number">1</span>]=a/<span class="hljs-number">4294967296</span>|<span class="hljs-number">0</span>;a=e.length;<span class="hljs-keyword">for</span>(c=<span class="hljs-number">0</span>;c&lt;a;c+=<span class="hljs-number">16</span>)g=A(e.slice(c,c+<span class="hljs-number">16</span>),g);<span class="hljs-keyword">return</span> g&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">X</span>(<span class="hljs-params">y</span>)</span>&#123;<span class="hljs-keyword">return</span>(y&lt;<span class="hljs-number">15.5</span>?<span class="hljs-string">&#x27;0&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>)+<span class="hljs-built_in">Math</span>.round(y).toString(<span class="hljs-number">16</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">V</span>(<span class="hljs-params">b</span>)</span>&#123;<span class="hljs-keyword">var</span> s=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&quot;</span>;<span class="hljs-keyword">var</span> t=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">var</span> h=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;b.length;i++)&#123;<span class="hljs-keyword">var</span> val=s.indexOf(b.charAt(i).toUpperCase());t+=T(val.toString(<span class="hljs-number">2</span>),<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;0&#x27;</span>)&#125;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i+<span class="hljs-number">4</span>&lt;=t.length;i+=<span class="hljs-number">4</span>)&#123;<span class="hljs-keyword">var</span> c=t.substr(i,<span class="hljs-number">4</span>);h=h+<span class="hljs-built_in">parseInt</span>(c,<span class="hljs-number">2</span>).toString(<span class="hljs-number">16</span>)&#125;<span class="hljs-keyword">return</span> h&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span>(<span class="hljs-params">s,l,p</span>)</span>&#123;<span class="hljs-keyword">if</span>(l+<span class="hljs-number">1</span>&gt;=s.length)&#123;s=<span class="hljs-built_in">Array</span>(l+<span class="hljs-number">1</span>-s.length).join(p)+s&#125;<span class="hljs-keyword">return</span> s&#125;<span class="hljs-keyword">return</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>)</span>&#123;<span class="hljs-keyword">var</span> k=V(s);<span class="hljs-keyword">var</span> e=<span class="hljs-built_in">Math</span>.round(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()/<span class="hljs-number">1000.0</span>);<span class="hljs-keyword">var</span> r=T(X(<span class="hljs-built_in">Math</span>.floor(e/<span class="hljs-number">30</span>)),<span class="hljs-number">16</span>,<span class="hljs-string">&#x27;0&#x27;</span>);<span class="hljs-keyword">var</span> j=<span class="hljs-keyword">new</span> t(<span class="hljs-string">&quot;SHA-1&quot;</span>,<span class="hljs-string">&quot;HEX&quot;</span>);j.setHMACKey(k,<span class="hljs-string">&quot;HEX&quot;</span>);j.update(r);<span class="hljs-keyword">var</span> h=j.getHMAC(<span class="hljs-string">&quot;HEX&quot;</span>);<span class="hljs-keyword">var</span> o=<span class="hljs-built_in">parseInt</span>(h.substring(h.length-<span class="hljs-number">1</span>),<span class="hljs-number">16</span>);<span class="hljs-keyword">var</span> p=(<span class="hljs-built_in">parseInt</span>(h.substr(o*<span class="hljs-number">2</span>,<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)&amp;<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">&#x27;7fffffff&#x27;</span>,<span class="hljs-number">16</span>))+<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">var</span> z=p.substr(p.length-<span class="hljs-number">6</span>,<span class="hljs-number">6</span>);<span class="hljs-keyword">return</span> z&#125;)(token)&#125;;<br></code></pre></td></tr></table></figure>

<p>TOTP函数生成的一次性密码遵循<a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc6238">RFC6238</a>规范，完全使用原生Javascript实现，可在任何Javascript环境中使用 (不依赖任何框架和类库)。</p>
<h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><p>该函数魔改至 <a target="_blank" rel="noopener" href="https://jsfiddle.net/russau/rbyjk774">https://jsfiddle.net/russau/rbyjk774</a> 并使用了<a target="_blank" rel="noopener" href="https://github.com/Caligatio">Brian Turek</a>的<a target="_blank" rel="noopener" href="https://github.com/Caligatio/jsSHA">jsSHA</a>，在此表示感谢。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>适用于Surge &amp; QuantumultX的一次性密码生成脚本 (TOTP)</p><p><a href="https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/">https://nobyda.github.io/2021/07/29/Javascript-TOTP-algorithm/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>NobyDa</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-07-29</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-07-29</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Surge/">Surge</a><a class="link-muted mr-2" rel="tag" href="/tags/QuantumultX/">QuantumultX</a><a class="link-muted mr-2" rel="tag" href="/tags/JavaScript/">JavaScript</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=60bb78906cfa7d00118e7e9e&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/donates.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/02/24/Surge_Rule_Storage/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">使用Surge规则脚本、快捷指令自动化生成专属规则集</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/07/24/Bahamut_daily_bonus_js_example/"><span class="level-item">巴哈姆特自动签到脚本（适配/开发实例）</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "a6033b6e6b6c0ea221e128f227265542",
            repo: "NobyDa.github.io",
            owner: "NobyDa",
            clientID: "84cc10757e7c7631cf71",
            clientSecret: "095f8b47cbdb5b1ef38709e44e7186cd951362b9",
            admin: ["NobyDa"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "first",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-3-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#原理"><span class="level-left"><span class="level-item">1</span><span class="level-item">原理</span></span></a></li><li><a class="level is-mobile" href="#实现"><span class="level-left"><span class="level-item">2</span><span class="level-item">实现</span></span></a></li><li><a class="level is-mobile" href="#示例"><span class="level-left"><span class="level-item">3</span><span class="level-item">示例</span></span></a></li><li><a class="level is-mobile" href="#致谢"><span class="level-left"><span class="level-item">4</span><span class="level-item">致谢</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"></a><p class="is-size-7"><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span><br><span>&copy; 2024 NobyDa's Blog is</span> powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>